boxlength = 29.9469998677572;
ksi = 2.837;
CONV = 332.112;
forwardPosQ = [ 0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardPosTotals = [ 0.13912 0.271887 0.33797 0.359033 0.364862 0.331134 0.265811 0.149471 0.0031294 -0.175928 -0.424979 -0.686864 -1.01186 -1.37664 -1.7915 -2.23032 -2.70892 -3.21267 -3.7409 -4.3055 -4.91507 -5.58886 -6.30741 -7.05325 -7.85566 -8.66709 -9.52333 -10.4251 -11.3898 -12.3726 -13.4002 -14.478 -15.5731 -16.736 -17.9172 -19.1722 -20.4503 -21.7518 -23.1474 -24.5887 -26.0557 -27.5804 -29.1265 -30.7247 -32.3731 -34.0294 -35.7417 -37.5112 -39.3129 -41.194 ]';
reversedBackwardPosTotals = [ 0.166837 0.275013 0.362778 0.3918664 0.38913579 0.34126619 0.27014009 0.15264409 -0.02863691 -0.23257091 -0.46276691 -0.73130691 -1.03838591 -1.39835291 -1.78231891 -2.18963391 -2.65071991 -3.15866491 -3.70494091 -4.27531591 -4.88131391 -5.54277591 -6.25372891 -6.98099891 -7.76708191 -8.55535791 -9.41570491 -10.34138291 -11.28869291 -12.26317491 -13.31389491 -14.40100491 -15.49668491 -16.63277491 -17.81704491 -19.07604491 -20.34864491 -21.70165491 -23.10972491 -24.50311491 -25.98076491 -27.50441491 -29.06517491 -30.65493491 -32.29930491 -33.99911491 -35.75962491 -37.54432491 -39.43101491 -41.30188491 ]';
correctedFPtotals = forwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
correctedBPtotals = reversedBackwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
forwardNegQ = [ -0.02 -0.04 -0.06 -0.08 -0.1 -0.12 -0.14 -0.16 -0.18 -0.2 -0.22 -0.24 -0.26 -0.28 -0.3 -0.32 -0.34 -0.36 -0.38 -0.4 -0.42 -0.44 -0.46 -0.48 -0.5 -0.52 -0.54 -0.56 -0.58 -0.6 -0.62 -0.64 -0.66 -0.68 -0.7 -0.72 -0.74 -0.76 -0.78 -0.8 -0.82 -0.84 -0.86 -0.88 -0.9 -0.92 -0.94 -0.96 -0.98 -1 ]';
forwardNegTotals = [ -0.196848 -0.414821 -0.680203 -1.00239 -1.39145 -1.81864 -2.30861 -2.81803 -3.40369 -4.03839 -4.73373 -5.46823 -6.24812 -7.0849 -7.97156 -8.95669 -9.91726 -11.0111 -12.1116 -13.3297 -14.5315 -15.7841 -17.1515 -18.6034 -20.1457 -21.7084 -23.3468 -25.0714 -26.8536 -28.6602 -30.549 -32.5001 -34.5781 -36.6778 -38.8593 -41.0666 -43.3714 -45.7439 -48.1891 -50.6394 -53.1865 -55.8796 -58.5905 -61.357 -64.268 -67.1654 -70.1818 -73.1907 -76.2517 -79.4374 ]';
reversedBackwardNegTotals = [ -0.146346 -0.408067 -0.688408 -1.036924 -1.401365 -1.814942 -2.313573 -2.808361 -3.371919 -3.984129 -4.666785 -5.404959 -6.245906 -7.094482 -7.994132 -8.945668 -9.933633 -10.963913 -12.116543 -13.334913 -14.564123 -15.894703 -17.279903 -18.734613 -20.257193 -21.854653 -23.496563 -25.193223 -27.018563 -28.872453 -30.787353 -32.792963 -34.760763 -36.852763 -39.030603 -41.276203 -43.587333 -46.028913 -48.496893 -51.005243 -53.571863 -56.208793 -58.930013 -61.684833 -64.520683 -67.420673 -70.385693 -73.439163 -76.576933 -79.725153 ]';
correctedFNtotals = forwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
correctedBNtotals = reversedBackwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
Qdata = [0; forwardPosQ; forwardPosQ; forwardNegQ; forwardNegQ;]; 
Edata = [0; correctedFPtotals; correctedBPtotals; correctedFNtotals; ...
	 correctedBNtotals;];

I = find(abs(Qdata) < 0.2);
lsmatConstrained = [Qdata(I).^2 Qdata(I)];
lsmatUnconstrained = [Qdata(I).^2 Qdata(I) ones(length(Qdata(I)),1)];
xConstrained = lsmatConstrained \ Edata(I);
xUnconstrained = lsmatUnconstrained \ Edata(I);
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
