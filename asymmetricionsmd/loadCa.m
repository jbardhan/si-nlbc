boxlength = 29.9469998677572;
ksi = 2.837;
CONV = 332.112;
forwardPosQ = [ 0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardPosTotals = [ 0.156051 0.252977 0.280246 0.259991 0.188399 0.0288439 -0.164253 -0.444431 -0.808596 -1.18121 -1.62703 -2.12688 -2.71509 -3.35452 -4.04082 -4.80739 -5.61773 -6.49682 -7.50305 -8.52869 -9.65128 -10.8313 -12.0326 -13.3764 -14.7745 -16.2001 -17.7118 -19.297 -20.9778 -22.7845 -24.6394 -26.4805 -28.4622 -30.5359 -32.6849 -34.8445 -37.1067 -39.4051 -41.8121 -44.249 -46.8057 -49.4723 -52.1686 -54.9997 -57.8467 -60.8257 -63.8175 -66.8504 -70.0223 -73.2533 ]';
reversedBackwardPosTotals = [ 0.154623 0.264883 0.26836654 0.23766504 0.15598624 0.01203124 -0.19726276 -0.45166476 -0.79837576 -1.16474376 -1.61009976 -2.13743376 -2.70276476 -3.32132476 -3.98783876 -4.73883576 -5.56702276 -6.43919576 -7.40309276 -8.44668276 -9.53779276 -10.69393276 -11.92001276 -13.29936276 -14.67918276 -16.14313276 -17.68141276 -19.30171276 -20.93925276 -22.66041276 -24.44481276 -26.36421276 -28.29827276 -30.36046276 -32.46220276 -34.68325276 -36.91791276 -39.27793276 -41.75071276 -44.23376276 -46.79512276 -49.40571276 -52.09933276 -54.94870276 -57.80818276 -60.74745276 -63.68061276 -66.73912276 -69.88997276 -73.17678276 ]';
correctedFPtotals = forwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
correctedBPtotals = reversedBackwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
forwardNegQ = [ -0.02 -0.04 -0.06 -0.08 -0.1 -0.12 -0.14 -0.16 -0.18 -0.2 -0.22 -0.24 -0.26 -0.28 -0.3 -0.32 -0.34 -0.36 -0.38 -0.4 -0.42 -0.44 -0.46 -0.48 -0.5 -0.52 -0.54 -0.56 -0.58 -0.6 -0.62 -0.64 -0.66 -0.68 -0.7 -0.72 -0.74 -0.76 -0.78 -0.8 -0.82 -0.84 -0.86 -0.88 -0.9 -0.92 -0.94 -0.96 -0.98 -1 ]';
forwardNegTotals = [ -0.226029 -0.508779 -0.887319 -1.3563 -1.86512 -2.50479 -3.24474 -4.0015 -4.96458 -5.92728 -7.07171 -8.26992 -9.69187 -11.1601 -12.8398 -14.5856 -16.5148 -18.569 -20.7813 -23.085 -25.4846 -28.0323 -30.7082 -33.4833 -36.4668 -39.5127 -42.7099 -45.9222 -49.2897 -52.8376 -56.4359 -60.2449 -64.0992 -68.0557 -72.1958 -76.5111 -80.8505 -85.3219 -89.9637 -94.5443 -99.4551 -104.436 -109.559 -114.744 -119.871 -125.215 -130.669 -136.195 -141.82 -147.505 ]';
reversedBackwardNegTotals = [ -0.200309 -0.494635 -0.885206 -1.304641 -1.815494 -2.47538 -3.173588 -3.950031 -4.86073 -5.89591 -7.01106 -8.26214 -9.65177 -11.20064 -12.74396 -14.46434 -16.36083 -18.31992 -20.43344 -22.76597 -25.17938 -27.73525 -30.41869 -33.2412 -36.19952 -39.28636 -42.48888 -45.79425 -49.31298 -52.857 -56.48894 -60.17536 -64.11286 -68.14383 -72.30284 -76.51867 -81.03096 -85.59238 -90.22864 -95.03511 -99.7514 -104.61858 -109.63343 -114.67336 -119.94326 -125.28591 -130.79871 -136.3189 -141.9311 -147.65477 ]';
correctedFNtotals = forwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
correctedBNtotals = reversedBackwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
Qdata = [0; forwardPosQ; forwardPosQ; forwardNegQ; forwardNegQ;]; 
Edata = [0; correctedFPtotals; correctedBPtotals; correctedFNtotals; correctedBNtotals;];
I = find(abs(Qdata)<0.2);
lsmatConstrained = [Qdata(I).^2 Qdata(I)];
lsmatUnconstrained = [Qdata(I).^2 Qdata(I) ones(length(Qdata(I)),1)];
xConstrained = lsmatConstrained \ Edata(I);
xUnconstrained = lsmatUnconstrained \ Edata(I);
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
