boxlength = 29.9469998677572;
ksi = 2.837;
CONV = 332.112;
forwardPosQ = [ 0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardPosTotals = [ 0.150776 0.229027 0.23737 0.227035 0.127366 -0.0378785 -0.259414 -0.516972 -0.821221 -1.20246 -1.64563 -2.15087 -2.73919 -3.40124 -4.10277 -4.8861 -5.75489 -6.65966 -7.63315 -8.65948 -9.73368 -10.9039 -12.172 -13.4836 -14.8486 -16.2847 -17.8199 -19.4046 -21.0617 -22.8359 -24.652 -26.5062 -28.4979 -30.5369 -32.6154 -34.8427 -37.1234 -39.4587 -41.902 -44.454 -47.0348 -49.6839 -52.3506 -55.1383 -58.0748 -61.0076 -64.0743 -67.0827 -70.2297 -73.4377 ]';
reversedBackwardPosTotals = [ 0.175076 0.289891 0.3287955 0.3426818 0.2458556 0.1015036 -0.0909854 -0.3618384 -0.7033044 -1.0948164 -1.5437954 -2.0924064 -2.6707774 -3.2708654 -3.9633184 -4.7470144 -5.5547414 -6.4636804 -7.4139014 -8.4340014 -9.5741214 -10.7518514 -11.9383414 -13.2474414 -14.6762614 -16.1553514 -17.6934514 -19.2910814 -20.9575014 -22.6914514 -24.5183214 -26.4376914 -28.4195114 -30.4977114 -32.6162714 -34.8381014 -37.1102414 -39.3959114 -41.8633214 -44.4441814 -46.9984614 -49.6532414 -52.3412414 -55.1021714 -58.0339114 -60.9951314 -63.9641814 -66.9996514 -70.1486614 -73.3468814 ]';
correctedFPtotals = forwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
correctedBPtotals = reversedBackwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
forwardNegQ = [ -0.02 -0.04 -0.06 -0.08 -0.1 -0.12 -0.14 -0.16 -0.18 -0.2 -0.22 -0.24 -0.26 -0.28 -0.3 -0.32 -0.34 -0.36 -0.38 -0.4 -0.42 -0.44 -0.46 -0.48 -0.5 -0.52 -0.54 -0.56 -0.58 -0.6 -0.62 -0.64 -0.66 -0.68 -0.7 -0.72 -0.74 -0.76 -0.78 -0.8 -0.82 -0.84 -0.86 -0.88 -0.9 -0.92 -0.94 -0.96 -0.98 -1 ]';
forwardNegTotals = [ -0.228963 -0.514518 -0.885968 -1.31697 -1.84025 -2.46474 -3.20348 -3.98737 -4.92386 -5.94931 -7.19024 -8.45134 -9.86499 -11.4326 -13.0596 -14.7851 -16.6757 -18.7112 -20.8817 -23.1966 -25.6256 -28.1451 -30.8112 -33.6357 -36.6228 -39.6676 -42.8744 -46.1727 -49.542 -53.1771 -56.8137 -60.6572 -64.4745 -68.4893 -72.6184 -76.9268 -81.3478 -85.9791 -90.6827 -95.2923 -100.095 -105.142 -110.257 -115.525 -120.755 -126.168 -131.654 -137.221 -142.858 -148.593 ]';
reversedBackwardNegTotals = [ -0.215293 -0.534974 -0.862167 -1.326901 -1.795417 -2.440014 -3.093386 -3.895965 -4.782091 -5.844651 -6.986761 -8.234561 -9.626661 -11.106201 -12.741911 -14.499761 -16.390271 -18.428251 -20.511531 -22.849871 -25.216301 -27.866331 -30.665971 -33.575611 -36.525751 -39.658171 -42.791621 -46.085471 -49.607811 -53.135911 -56.910641 -60.615451 -64.575071 -68.664301 -72.828601 -77.174361 -81.569631 -85.995211 -90.519561 -95.323821 -100.046401 -104.985211 -110.013211 -115.268671 -120.610771 -126.039301 -131.507441 -137.142271 -142.833711 -148.588931 ]';
correctedFNtotals = forwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
correctedBNtotals = reversedBackwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
Qdata = [0; forwardPosQ; forwardPosQ; forwardNegQ; forwardNegQ;]; 
Edata = [0; correctedFPtotals; correctedBPtotals; correctedFNtotals; correctedBNtotals;];
I = find(abs(Qdata) < 0.2);
lsmatConstrained = [Qdata(I).^2 Qdata(I)];
lsmatUnconstrained = [Qdata(I).^2 Qdata(I) ones(length(Qdata(I)),1)];
xConstrained = lsmatConstrained \ Edata(I);
xUnconstrained = lsmatUnconstrained \ Edata(I);
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
