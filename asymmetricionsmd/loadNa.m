boxlength = 29.9469998677572;
ksi = 2.837;
CONV = 332.112;
forwardPosQ = [ 0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardPosTotals = [ 0.169613 0.278052 0.318787 0.325356 0.194866 0.00127224 -0.185834 -0.447456 -0.823953 -1.16844 -1.65501 -2.13683 -2.72122 -3.34914 -4.07908 -4.87611 -5.70725 -6.65185 -7.67001 -8.69189 -9.83409 -11.0174 -12.3015 -13.5894 -15.0236 -16.5267 -18.0686 -19.7298 -21.4154 -23.2169 -25.0751 -26.9844 -29.0428 -31.1336 -33.2842 -35.5911 -37.9005 -40.343 -42.8045 -45.3169 -47.9276 -50.6648 -53.482 -56.3364 -59.357 -62.3902 -65.4848 -68.655 -71.8974 -75.1979 ]';
reversedBackwardPosTotals = [ 0.15339 0.254822 0.2868416 0.2667415 0.2019531 0.0649811 -0.1520219 -0.4097239 -0.7697699 -1.1933349 -1.6711659 -2.1955459 -2.8101279 -3.4945519 -4.1941069 -4.9560629 -5.8199689 -6.6963839 -7.6642529 -8.7381029 -9.8463429 -11.0948929 -12.4273929 -13.7255129 -15.1697929 -16.6836829 -18.3041129 -19.9624929 -21.7014029 -23.4686029 -25.3590229 -27.3421129 -29.4223129 -31.5226229 -33.7166029 -36.0089629 -38.3286529 -40.7543629 -43.1772129 -45.8014829 -48.4210829 -51.1194829 -53.9280729 -56.7867929 -59.7099429 -62.7778329 -65.9226729 -69.1935729 -72.4471329 -75.7761729 ]';
correctedFPtotals = forwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
correctedBPtotals = reversedBackwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
forwardNegQ = [ -0.02 -0.04 -0.06 -0.08 -0.1 -0.12 -0.14 -0.16 -0.18 -0.2 -0.22 -0.24 -0.26 -0.28 -0.3 -0.32 -0.34 -0.36 -0.38 -0.4 -0.42 -0.44 -0.46 -0.48 -0.5 -0.52 -0.54 -0.56 -0.58 -0.6 -0.62 -0.64 -0.66 -0.68 -0.7 -0.72 -0.74 -0.76 -0.78 -0.8 -0.82 -0.84 -0.86 -0.88 -0.9 -0.92 -0.94 -0.96 -0.98 -1 ]';
forwardNegTotals = [ -0.229972 -0.554936 -0.944525 -1.41637 -1.91674 -2.57831 -3.2786 -4.17403 -5.13687 -6.21102 -7.33754 -8.59632 -9.95869 -11.4745 -13.1928 -15.0825 -17.0762 -19.2335 -21.4648 -23.8997 -26.4297 -29.0717 -31.8042 -34.7916 -37.9205 -41.1439 -44.5284 -48.0097 -51.5878 -55.3053 -59.0645 -63.0471 -67.0221 -71.3104 -75.6071 -80.0178 -84.5786 -89.1708 -93.9769 -99.0959 -104.048 -109.139 -114.171 -119.428 -124.8 -130.323 -135.999 -141.852 -147.72 -153.664 ]';
reversedBackwardNegTotals = [ -0.211511 -0.505078 -0.945613 -1.370895 -1.880035 -2.52085 -3.250114 -4.036475 -4.960035 -6.056975 -7.217015 -8.485145 -9.904385 -11.450425 -13.142245 -14.899245 -16.837655 -19.036975 -21.294465 -23.605785 -26.169505 -28.805405 -31.561655 -34.533655 -37.695935 -40.927405 -44.241395 -47.710025 -51.285585 -54.951445 -58.709775 -62.604545 -66.652145 -70.804675 -74.990675 -79.442515 -84.107415 -88.813435 -93.683695 -98.743465 -103.801265 -109.084575 -114.301455 -119.712925 -125.193085 -130.809325 -136.500605 -142.228415 -148.151975 -154.123445 ]';
correctedFNtotals = forwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
correctedBNtotals = reversedBackwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
Qdata = [0; forwardPosQ; forwardPosQ; forwardNegQ; forwardNegQ;]; 
Edata = [0; correctedFPtotals; correctedBPtotals; correctedFNtotals; correctedBNtotals;];
lsmatConstrained = [Qdata.^2 Qdata];
lsmatUnconstrained = [Qdata.^2 Qdata ones(length(Qdata),1)];
xConstrained = lsmatConstrained \ Edata;
xUnconstrained = lsmatUnconstrained \ Edata;
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
