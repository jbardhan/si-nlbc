boxlength = 29.9469998677572;
ksi = 2.837;
CONV = 332.112;
forwardPosQ = [ 0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardPosTotals = [ 0.141588 0.258372 0.313542 0.330715 0.285989 0.199953 0.0803665 -0.087692 -0.320956 -0.586689 -0.907236 -1.25252 -1.67788 -2.08226 -2.54174 -3.05916 -3.65457 -4.26546 -4.91686 -5.62848 -6.38855 -7.22126 -8.09674 -9.00677 -9.96055 -10.9625 -12.0313 -13.1633 -14.3305 -15.5212 -16.8132 -18.1331 -19.4897 -20.9297 -22.3911 -23.9592 -25.5445 -27.1784 -28.9277 -30.6755 -32.4712 -34.348 -36.2411 -38.216 -40.2204 -42.3182 -44.5362 -46.7431 -49.0376 -51.2966 ]';
reversedBackwardPosTotals = [ 0.187412 0.278178 0.378868 0.38661102 0.33362502 0.24098242 0.11177642 -0.03830658 -0.24607058 -0.49094458 -0.80221158 -1.14928458 -1.52273558 -1.98751358 -2.46323358 -2.99867358 -3.59893758 -4.24689058 -4.92044058 -5.65600558 -6.45050558 -7.28180158 -8.13884058 -9.03756458 -9.99292758 -10.97437058 -11.98164058 -13.10207058 -14.27714058 -15.49024058 -16.75204058 -18.08750058 -19.47035058 -20.87568058 -22.32215058 -23.86738058 -25.47025058 -27.14265058 -28.83809058 -30.54305058 -32.36083058 -34.22268058 -36.16030058 -38.16270058 -40.16567058 -42.22055058 -44.42985058 -46.62889058 -48.85756058 -51.20152058 ]';
correctedFPtotals = forwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
correctedBPtotals = reversedBackwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
forwardNegQ = [ -0.02 -0.04 -0.06 -0.08 -0.1 -0.12 -0.14 -0.16 -0.18 -0.2 -0.22 -0.24 -0.26 -0.28 -0.3 -0.32 -0.34 -0.36 -0.38 -0.4 -0.42 -0.44 -0.46 -0.48 -0.5 -0.52 -0.54 -0.56 -0.58 -0.6 -0.62 -0.64 -0.66 -0.68 -0.7 -0.72 -0.74 -0.76 -0.78 -0.8 -0.82 -0.84 -0.86 -0.88 -0.9 -0.92 -0.94 -0.96 -0.98 -1 ]';
forwardNegTotals = [ -0.214722 -0.490725 -0.781254 -1.14557 -1.56585 -2.04249 -2.59439 -3.1876 -3.89912 -4.63967 -5.43528 -6.28988 -7.23259 -8.23322 -9.31647 -10.4798 -11.7263 -13.0202 -14.4455 -15.9287 -17.5633 -19.2223 -20.9645 -22.8222 -24.7309 -26.7143 -28.781 -30.9843 -33.235 -35.5071 -37.9391 -40.3931 -42.9951 -45.6625 -48.481 -51.3415 -54.2672 -57.2912 -60.3521 -63.491 -66.7155 -70.0441 -73.4598 -76.9221 -80.453 -84.1062 -87.8378 -91.654 -95.5669 -99.5088 ]';
reversedBackwardNegTotals = [ -0.202611 -0.482057 -0.800593 -1.175308 -1.561716 -2.05562 -2.588985 -3.218574 -3.870559 -4.61766 -5.38539 -6.192373 -7.139446 -8.107631 -9.160311 -10.293021 -11.520411 -12.820901 -14.291621 -15.737631 -17.344511 -18.995971 -20.770801 -22.596411 -24.436721 -26.466731 -28.501421 -30.670301 -32.910741 -35.269781 -37.676271 -40.180071 -42.796081 -45.513281 -48.225411 -51.072051 -54.043741 -57.012311 -60.112301 -63.281821 -66.538051 -69.898031 -73.328481 -76.791691 -80.352831 -84.029971 -87.724681 -91.512551 -95.360991 -99.346861 ]';
correctedFNtotals = forwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
correctedBNtotals = reversedBackwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
Qdata = [0; forwardPosQ; forwardPosQ; forwardNegQ; forwardNegQ;]; 
Edata = [0; correctedFPtotals; correctedBPtotals; correctedFNtotals; correctedBNtotals;];
I = find(abs(Qdata) < 0.2);
lsmatConstrained = [Qdata(I).^2 Qdata(I)];
lsmatUnconstrained = [Qdata(I).^2 Qdata(I) ones(length(Qdata(I)),1)];
xConstrained = lsmatConstrained \ Edata(I);
xUnconstrained = lsmatUnconstrained \ Edata(I);
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
