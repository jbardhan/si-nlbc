boxlength = 29.9469998677572;
ksi = 2.837;
CONV = 332.112;
forwardPosQ = [ 0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardPosTotals = [ 0.188767 0.308499 0.295913 0.220217 0.0947185 -0.123115 -0.409097 -0.774745 -1.19344 -1.73186 -2.35384 -3.04659 -3.81419 -4.65063 -5.61891 -6.61969 -7.77177 -9.00142 -10.2876 -11.7163 -13.2008 -14.7032 -16.3571 -18.122 -19.9674 -21.8756 -23.8518 -25.9975 -28.2158 -30.5215 -32.9056 -35.4539 -37.9765 -40.6171 -43.3222 -46.1539 -48.9862 -51.9336 -54.9388 -58.0185 -61.1764 -64.4779 -67.8098 -71.2122 -74.6628 -78.187 -81.8311 -85.5119 -89.3266 -93.1719 ]';
reversedBackwardPosTotals = [ 0.125674 0.2188051 0.2447435 0.1710563 0.0363003 -0.1955487 -0.4884697 -0.8019377 -1.2622967 -1.7636107 -2.4387297 -3.1135467 -3.8602147 -4.6522267 -5.5504107 -6.4897927 -7.6255927 -8.7982727 -10.1152927 -11.5101727 -13.0228427 -14.5481227 -16.2368127 -18.0047227 -19.8656427 -21.7736827 -23.7594027 -25.8392027 -28.0282727 -30.3342927 -32.6797327 -35.1824827 -37.7476727 -40.3412027 -43.0349127 -45.8377427 -48.7498927 -51.7043827 -54.7422427 -57.8581627 -61.0279127 -64.2975827 -67.6636627 -71.1043027 -74.5367527 -78.0845127 -81.7570627 -85.3202427 -89.0500227 -92.9047027 ]';
correctedFPtotals = forwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
correctedBPtotals = reversedBackwardPosTotals - 0.5*ksi*CONV*forwardPosQ.^2 / boxlength;
forwardNegQ = [ -0.02 -0.04 -0.06 -0.08 -0.1 -0.12 -0.14 -0.16 -0.18 -0.2 -0.22 -0.24 -0.26 -0.28 -0.3 -0.32 -0.34 -0.36 -0.38 -0.4 -0.42 -0.44 -0.46 -0.48 -0.5 -0.52 -0.54 -0.56 -0.58 -0.6 -0.62 -0.64 -0.66 -0.68 -0.7 -0.72 -0.74 -0.76 -0.78 -0.8 -0.82 -0.84 -0.86 -0.88 -0.9 -0.92 -0.94 -0.96 -0.98 -1 ]';
forwardNegTotals = [ -0.294475 -0.642846 -1.0808 -1.69547 -2.4355 -3.16671 -4.07686 -5.25446 -6.54116 -8.01174 -9.72862 -11.6218 -13.7473 -16.0094 -18.4116 -21.0177 -23.8278 -26.8897 -30.1429 -33.605 -37.1646 -40.8384 -44.6882 -48.9179 -53.3336 -57.8408 -62.4997 -67.3508 -72.3625 -77.4099 -82.5828 -87.8842 -93.248 -98.707 -104.243 -109.923 -115.672 -121.546 -127.604 -133.664 -139.828 -146.099 -152.376 -159.18 -165.853 -172.786 -179.999 -187.134 -194.409 -201.755 ]';
reversedBackwardNegTotals = [ -0.236746 -0.591933 -1.036315 -1.588714 -2.283973 -3.131116 -4.079301 -5.266141 -6.613411 -8.103691 -9.801401 -11.679521 -13.751051 -16.046071 -18.550071 -21.197751 -24.044231 -27.087001 -30.359691 -33.711181 -37.379711 -41.147071 -45.224431 -49.535451 -53.981311 -58.545671 -63.234031 -68.025151 -72.931801 -77.982591 -83.121731 -88.428371 -93.787291 -99.265611 -104.824681 -110.540341 -116.272691 -122.064901 -127.973561 -133.954201 -140.326941 -146.609301 -153.190611 -159.805441 -166.567791 -173.546531 -180.628521 -187.912441 -195.240431 -202.785501 ]';
correctedFNtotals = forwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
correctedBNtotals = reversedBackwardNegTotals - 0.5*ksi*CONV*forwardNegQ.^2 / boxlength;
Qdata = [0; forwardPosQ; forwardPosQ; forwardNegQ; forwardNegQ;]; 
Edata = [0; correctedFPtotals; correctedBPtotals; correctedFNtotals; correctedBNtotals;];

I = find(abs(Qdata) < 0.2);
lsmatConstrained = [Qdata(I).^2 Qdata(I)];
lsmatUnconstrained = [Qdata(I).^2 Qdata(I) ones(length(Qdata(I)),1)];
xConstrained = lsmatConstrained \ Edata(I);
xUnconstrained = lsmatUnconstrained \ Edata(I);
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
